# ShortLinks CLI

Инструмент для управления короткими ссылками.

---

## Описание

ShortLinks CLI — консольное приложение для создания, удаления и управления короткими ссылками.  
Программа использует SQLite как встроенную базу данных и JOOQ для работы с SQL на уровне объектной модели.

---

## Используемые библиотеки

- **Spring Context** — управление зависимостями и конфигурацией приложения.  
- **SQLite JDBC** — драйвер для взаимодействия с базой данных SQLite.  
- **JOOQ** — генерация и выполнение SQL-запросов через DSL.  
- **Lombok** — сокращение шаблонного кода (геттеры, конструкторы и т.д.).  
- **Liquibase** — миграции и управление схемой базы данных.  

---

## Инструкция по сборке и запуску

| Этап | Команда |
|------|----------|
| 1. Применить миграции базы данных | `./gradlew update` |
| 2. Сгенерировать JOOQ-код | `./gradlew generateJooq` |
| 3. Проверить стиль кода | `./gradlew spotlessCheck` |
| 4. Собрать проект | `./gradlew build` |
| 5. Создать исполняемый jar | `./gradlew :fatJar` |

**Запуск из корня проекта:**
```bash
java -jar build/libs/SortLinksCLI-1.0-SNAPSHOT-all.jar help
```

---

## Команды CLI

- **shorten** — создать короткую ссылку из указанного URL.  
- **prune** — удалить короткую ссылку или все ссылки пользователя.  
- **open** — открыть сокращённую ссылку в браузере.  
- **ttlGlobal** — задать глобальное время жизни ссылок (TTL).  
- **help** — показать справку по доступным командам.

---

## Примечания

- Конфигурация администратора хранится в `admin.properties`.  
- Параметр `admin.password` задаёт пароль администратора.  
- Команды, не требующие прав администратора (`shorten`, `open`), можно выполнять от имени пользователя через `-u <uuid>`.

---

## Подробное описание команд

```
ShortLinks CLI — инструмент для управления короткими ссылками
------------------------------------------------------------

Использование:
  java -jar shortlinks.jar <команда> [опции] [аргументы]

Доступные команды:

  shorten
      Создать короткую ссылку из указанного URL.
      Принимает не обязательный идентификатор пользователя (-u) и исходный URL.
      Если UUID не задан, то создается новый пользователь.
      Принимает не обязательные параметры -ttl — ttl ссылки, конфигурируемый пользователем
      в секундах, имеет приоритет ниже глобального ttl, -nq — максимальное число запросов по
      ссылке. Если -ttl или -nq не заданы, то считается, что нет ограничений пользователя на число
      переходов и время жизни ссылки.
      Возвращает короткий идентификатор, связанный с этой ссылкой.
      Пример:
        java -jar shortlinks.jar shorten -u 550e8400-e29b-41d4-a716-446655440000 \
            https://yandex.ru/dev/weather/doc/ru/concepts/forecast-rest
        java -jar shortlinks.jar shorten -u 550e8400-e29b-41d4-a716-446655440000 \
            -ttl 1111 \
            https://yandex.ru/dev/weather/doc/ru/concepts/forecast-rest
        java -jar shortlinks.jar shorten -u 550e8400-e29b-41d4-a716-446655440000 \
            -nq 10 \
            https://yandex.ru/dev/weather/doc/ru/concepts/forecast-rest

  prune
      Удалить короткую ссылку.
      После удаления переход по этой ссылке станет невозможен.
      Принимает не обязательный идентификатор пользователя (-u) и сокращенный URL.
      Если UUID не задан, то утилита предложит Вам авторизоваться под учетной записью админа.
      Пример:
        java -jar shortlinks.jar prune -u 550e8400-e29b-41d4-a716-446655440000 clck.ru/B
            Удаление ссылки clck.ru/B пользователя 550e8400-e29b-41d4-a716-446655440000.
        java -jar shortlinks.jar prune clck.ru/B
            Удаление ссылки clck.ru/B администратором, необходим пароль администратора,
            задается в переменной admin.password в файле admin.properties.
        java -jar shortlinks.jar prune -u 550e8400-e29b-41d4-a716-446655440000
            Удаление всех ссылок пользователя 550e8400-e29b-41d4-a716-446655440000.

  open
      Перейти по сокращенной ссылке.
      Открывает исходную ссылку в браузере по-умолчанию.
      Принимает обязательный идентификатор пользователя (-u) и сокращенный URL.
      Пример:
        java -jar shortlinks.jar open -u 550e8400-e29b-41d4-a716-446655440000 clck.ru/B
            Открывает в браузере исходную ссылку clck.ru/B.

  ttlGlobal
      Задать глобальный ttl жизни ссылок в секундах.
      Принимает обязательный параметр ttl, требует выполнения под учетной записью
      администратора.
      Пример
      java -jar shortlinks.jar ttlGlobal 1111111
            Задает глобальный ttl жизни ссылок равным 1111111 секундам.

  help
      Показать справку по программе.
      Пример:
        java -jar shortlinks.jar help

------------------------------------------------------------
```
